os: osx
language: objective-c
osx_image: xcode10.2
addons:
  ssh_known_hosts: packages.breez.technology
before_script:
- openssl aes-256-cbc -K $encrypted_fb5c5bbb0f3b_key -iv $encrypted_fb5c5bbb0f3b_iv
  -in build_server_rsa.enc -out build_server_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 build_server_rsa
- ssh-add build_server_rsa
- "./travis/add-key.sh"
- brew install golang
- brew install bazaar
- git clone https://github.com/breez/breez.git gopath/src/github.com/breez/breez
- export TMP_GOPATH=$(pwd)/gopath
- pushd gopath/src/github.com/breez/breez
- git checkout -t origin/ios
- go mod vendor
- export GOPATH=$TMP_GOPATH
- go get golang.org/x/mobile/cmd/gomobile
- go get golang.org/x/mobile/cmd/gobind
- "$GOPATH/bin/gomobile init"
- mkdir -p build/ios
- PATH=$PATH:$GOPATH/bin gomobile bind -target=ios -tags="ios experimental" -o build/ios/bindings.framework
  github.com/breez/breez/bindings
- popd
- brew install --HEAD usbmuxd
- brew link usbmuxd
- brew install --HEAD libimobiledevice
- brew install ideviceinstaller ios-deploy
- pod setup
- git clone https://github.com/flutter/flutter.git -b beta
script:
- mkdir $TRAVIS_BUILD_DIR/conf
- cp -r $GOPATH/src/github.com/breez/breez/build/ios/bindings.framework $TRAVIS_BUILD_DIR/ios/bindings.framework
- sftp builderfiles@packages.breez.technology:config/conf/lnd.conf $TRAVIS_BUILD_DIR/conf/lnd.conf
- sftp builderfiles@packages.breez.technology:config/conf/breez.conf $TRAVIS_BUILD_DIR/conf/breez.conf
- sftp builderfiles@packages.breez.technology:config/conf/marketplace.conf $TRAVIS_BUILD_DIR/conf/marketplace.conf
- sftp builderfiles@packages.breez.technology:config/conf/GoogleService-Info.plist
  $TRAVIS_BUILD_DIR/ios/Runner/GoogleService-Info.plist
- "./flutter/bin/flutter build ios --no-codesign"
after_success:
- "./travis/sign.sh"
cache:
  directories:
  - "$HOME/.pub-cache"
env:
  global:
  - secure: QZp8VNCEixRL0SxUJMuEpk7WEkUs8nXy44MitvIgW9VZdACL+ncAY+1/XFW/sNZLYtkZufsMFVnVizihcJtcazW8MXcuEU+AVvI12UfZ8MUAEjkdJ+BIfiKY2jg0/NqSpLyfI53z8wmDepCkD1Bta8OnfM3fCWkGw8C7LpidTfASsI1fxW3ykC8y1CyZNmzb2AWWGFSrehL6ukW1yKgK9ppXT8bdc3NPkK1/UfxwbZinx+bqEG7yZ6KmPM6J6f0KuPgWVMQDe1W4ld8+BRR1Bo4iz/v5Tv/NKYZ3jc51WhupCpjIy6harpt+cjgpQht7kNtFSclUq5+lz/+UiWiKmg/uwI0JIbuskXUM6WTgcFNXJilWvUlTVnp0VFPx1edfMAon/cwR/aXpW+ZS6CKMAJIvMyYbvpsXT9PQh1dVPqwGoA83hK9Huds0RwUPOJrZeM5atpxXR4saDgw4iys2mviP6cerAWmVHZlOyTCWitMmrdsCp04w8RwCXQLQcY0381lvYlhibflkWC5DHneQKK277pFOIKthBSJTYXyWzunOyGZVIelh9mPZz7hnP0tyCHvyqlxlLdKSo9CMRnXuL2XDt3UFXg+9jrXpDkGVR3bG2FTPMsmLvFGevaoUJic1nVVKzypDoOGFr9aA+84cu5GCErGxUA+6ZP3jA7RZcvw=
  - secure: nh0DkEsjIbJTWePfrSjQhGGCh7d6Zr/fnkOQmKvcxjAsIt8NXybZJSirto68CSpx9kxh3Pks3jI6L3rMxgWBQ8OJMtAeKkSGgsTyto4DDdSgCUSsa2EewCWxjVCRRvDDpLHThUngXl9EifwVIZihEiJh5pH/7Aq7ngPW0VEXQ7hR5I/FzCVoTUkVEXF8Vb7VhIqeM28KeARNeSYVs+iNcH4S8D8vbLvBtbSYV0pkucjF2EyheCkIIF3Vke/vw1t0Uocwx0NFO/JHxq5O9hJQg9BVNck9nrwuVH0T/65XX5WiJpYl5eMT/SWXuPVChIFWDkKUd1elqim0h0VvHiJqpJMfwKtwg78spALHpjagfoyL8Kj3Ewwi0pzNb6btpjKyQQvk84QDk1xXFSmZ/U5dAiM554q1Vm29kBwo5hdYJgC/SmUb9yNlQ1u+a2rj/Ii9N3k4vvw4ZP1jswZt1ICGSrFNR3hQhv6tu8trvPBKOf6hWYzlJP8Pzo2C/YdoNXLer0s4IQ7cbsP+tvFsYBgY/jMBHlI+LmfUrA+DhR3fgOGt79f48fDosA4bK8IrtWtnCyLQQRTstuFsBt6kCbBhPP9dV0lmTB5Vw+cNYi1GKs2pmRRSzr7QJ+Vnl17QqdEW+MQ71+/GVqGo+y3s4kntO7F4C7LNl+5CtsmGIrmp7bM=
